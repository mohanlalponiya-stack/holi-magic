<!DOCTYPE html>
<html lang="hi">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>üé® Holi AI Magic</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- React -->
  <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

  <style>
    body{
      background:#050505;
      color:white;
      font-family: system-ui, -apple-system, BlinkMacSystemFont;
    }
  </style>
</head>

<body>
  <div id="root"></div>

  <script type="text/babel">
    const { useState, useRef } = React;

    function App(){
      const [original,setOriginal] = useState(null);
      const [result,setResult] = useState(null);
      const [shayari,setShayari] = useState("");
      const [loading,setLoading] = useState(false);
      const [error,setError] = useState("");

      const fileRef = useRef();

      // üîó call Vercel API
      async function callGemini(model, payload){
        const res = await fetch("/api/gemini",{
          method:"POST",
          headers:{ "Content-Type":"application/json" },
          body: JSON.stringify({ model, payload })
        });
        if(!res.ok) throw new Error("AI ‡§∏‡§∞‡•ç‡§µ‡§∞ ‡§∏‡•á ‡§ú‡§µ‡§æ‡§¨ ‡§®‡§π‡•Ä‡§Ç ‡§Æ‡§ø‡§≤‡§æ");
        return res.json();
      }

      async function applyMagic(img){
        try{
          setLoading(true);
          setError("");
          setResult(null);
          setShayari("");

          const base64 = img.split(",")[1];

          // üé® Image generation
          const imgRes = await callGemini(
            "gemini-2.5-flash-image-preview",
            {
              contents:[{
                parts:[
                  { text:"‡§π‡•ã‡§≤‡•Ä ‡§ï‡•á ‡§∞‡§Ç‡§ó, ‡§ó‡•Å‡§≤‡§æ‡§≤, ‡§´‡•á‡§∏‡•ç‡§ü‡§ø‡§µ ‡§¨‡•à‡§ï‡§ó‡•ç‡§∞‡§æ‡§â‡§Ç‡§° ‡§ú‡•ã‡§°‡§º‡•ã" },
                  { inlineData:{ mimeType:"image/png", data: base64 } }
                ]
              }]
            }
          );

          const imgData =
            imgRes.candidates?.[0]?.content?.parts?.find(p=>p.inlineData)?.inlineData?.data;

          if(!imgData) throw new Error("AI image generate ‡§®‡§π‡•Ä‡§Ç ‡§ï‡§∞ ‡§™‡§æ‡§Ø‡§æ");

          setResult("data:image/png;base64,"+imgData);

          // ‚úçÔ∏è Shayari
          const shRes = await callGemini(
            "gemini-2.5-flash-preview-09-2025",
            { contents:[{ parts:[{ text:"‡§π‡•ã‡§≤‡•Ä ‡§™‡§∞ 2 ‡§≤‡§æ‡§á‡§® ‡§ï‡•Ä ‡§∂‡§æ‡§Ø‡§∞‡•Ä ‡§≤‡§ø‡§ñ‡•ã" }] }] }
          );

          setShayari(
            shRes.candidates?.[0]?.content?.parts?.[0]?.text ||
            "‡§π‡•ã‡§≤‡•Ä ‡§ï‡•Ä ‡§π‡§æ‡§∞‡•ç‡§¶‡§ø‡§ï ‡§∂‡•Å‡§≠‡§ï‡§æ‡§Æ‡§®‡§æ‡§è‡§Å üå∏"
          );
        }
        catch(e){
          setError(e.message);
        }
        finally{
          setLoading(false);
        }
      }

      function upload(e){
        const f = e.target.files[0];
        if(!f) return;
        const r = new FileReader();
        r.onload = ev => {
          setOriginal(ev.target.result);
          applyMagic(ev.target.result);
        };
        r.readAsDataURL(f);
      }

      return (
        <div className="min-h-screen flex flex-col items-center justify-center gap-6 p-6 text-center">

          <h1 className="text-4xl font-black">üé® Holi AI Magic</h1>

          <input
            ref={fileRef}
            type="file"
            accept="image/*"
            hidden
            onChange={upload}
          />

          <button
            onClick={()=>fileRef.current.click()}
            className="px-6 py-3 rounded-xl bg-pink-600 font-bold"
          >
            ‡§´‡•ã‡§ü‡•ã ‡§ö‡•Å‡§®‡•á‡§Ç
          </button>

          {loading && <p className="text-pink-400">AI ‡§ï‡§æ‡§Æ ‡§ï‡§∞ ‡§∞‡§π‡§æ ‡§π‡•à...</p>}
          {error && <p className="text-red-400">{error}</p>}

          {result && (
            <>
              <img src={result} className="w-72 rounded-xl shadow-lg"/>
              <p className="italic text-pink-300">‚Äú{shayari}‚Äù</p>
            </>
          )}

        </div>
      );
    }

    ReactDOM.createRoot(document.getElementById("root")).render(<App/>);
  </script>
</body>
</html>
