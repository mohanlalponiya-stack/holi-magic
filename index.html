import React, { useState, useRef, useEffect } from 'react';
import { 
  Camera, 
  Sparkles, 
  Download, 
  RefreshCw, 
  Heart, 
  Zap, 
  ShieldCheck, 
  Image as ImageIcon,
  Palette,
  ChevronDown,
  Star,
  Layers,
  Smile,
  CheckCircle2,
  ArrowRight
} from 'lucide-react';

const App = () => {
  const [originalImage, setOriginalImage] = useState(null);
  const [processedImage, setProcessedImage] = useState(null);
  const [isProcessing, setIsProcessing] = useState(false);
  const [error, setError] = useState(null);
  const [scrolled, setScrolled] = useState(false);
  const [particles, setParticles] = useState([]);
  
  const fileInputRef = useRef(null);
  const editorRef = useRef(null);
  const apiKey = ""; 

  // स्क्रॉल एनिमेशन के लिए
  useEffect(() => {
    const handleScroll = () => setScrolled(window.scrollY > 50);
    window.addEventListener('scroll', handleScroll);
    return () => window.removeEventListener('scroll', handleScroll);
  }, []);

  // बैकग्राउंड में रंगीन 'Color Rain' और पार्टिकल्स
  useEffect(() => {
    const colors = ['#FF1493', '#00BFFF', '#32CD32', '#FFD700', '#FF4500', '#8A2BE2'];
    const initialParticles = Array.from({ length: 40 }).map(() => ({
      id: Math.random(),
      x: Math.random() * 100,
      y: Math.random() * 100,
      size: Math.random() * 8 + 4,
      color: colors[Math.floor(Math.random() * colors.length)],
      duration: Math.random() * 10 + 10,
      delay: Math.random() * 5,
    }));
    setParticles(initialParticles);
  }, []);

  // AI होली एडिटिंग फंक्शन
  const applyAiHoliMagic = async (imageUri) => {
    setIsProcessing(true);
    setError(null);

    const base64Data = imageUri.split(',')[1];
    const prompt = "High-quality Holi festival transformation. Add artistic and vibrant gulal (powder color) splashes on the person's face and clothes. The colors should look organic and slightly messy but joyful. The background should be transformed into a festive setting with colorful bokeh, floating color dust, and a bright happy morning atmosphere. Professional photography style.";

    const payload = {
      contents: [{
        parts: [
          { text: prompt },
          { inlineData: { mimeType: "image/png", data: base64Data } }
        ]
      }],
      generationConfig: { responseModalities: ['TEXT', 'IMAGE'] }
    };

    const callApi = async (retryCount = 0) => {
      try {
        const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-image-preview:generateContent?key=${apiKey}`, {
          method: 'POST',
          headers: { 'Content-Type': 'application/json' },
          body: JSON.stringify(payload)
        });

        if (!response.ok) throw new Error('API Error');
        const result = await response.json();
        const base64 = result.candidates?.[0]?.content?.parts?.find(p => p.inlineData)?.inlineData?.data;
        
        if (base64) setProcessedImage(`data:image/png;base64,${base64}`);
        else throw new Error('No Image');
      } catch (err) {
        if (retryCount < 5) {
          await new Promise(r => setTimeout(r, Math.pow(2, retryCount) * 1000));
          return callApi(retryCount + 1);
        }
        setError("सर्वर पर बहुत लोड है, कृपया दोबारा प्रयास करें।");
      } finally {
        setIsProcessing(false);
      }
    };
    await callApi();
  };

  const handleUpload = (e) => {
    const file = e.target.files[0];
    if (file) {
      const reader = new FileReader();
      reader.onload = (ev) => {
        setOriginalImage(ev.target.result);
        setProcessedImage(null);
        applyAiHoliMagic(ev.target.result);
        editorRef.current?.scrollIntoView({ behavior: 'smooth' });
      };
      reader.readAsDataURL(file);
    }
  };

  const scrollToEditor = () => editorRef.current?.scrollIntoView({ behavior: 'smooth' });

  return (
    <div className="min-h-screen bg-[#050505] text-white selection:bg-pink-500/30 overflow-x-hidden">
      
      {/* Dynamic Background Particles */}
      <div className="fixed inset-0 pointer-events-none z-0">
        {particles.map(p => (
          <div 
            key={p.id} 
            className="absolute rounded-full blur-2xl opacity-20 animate-pulse" 
            style={{
              left: `${p.x}%`, 
              top: `${p.y}%`, 
              width: `${p.size}rem`, 
              height: `${p.size}rem`,
              backgroundColor: p.color,
              animationDuration: `${p.duration}s`,
              animationDelay: `${p.delay}s`
            }} 
          />
        ))}
      </div>

      {/* Navigation */}
      <nav className={`fixed top-0 w-full z-50 transition-all duration-500 ${scrolled ? 'bg-black/60 backdrop-blur-xl py-3 border-b border-white/5' : 'bg-transparent py-6'}`}>
        <div className="max-w-7xl mx-auto px-6 flex justify-between items-center">
          <div className="flex items-center gap-3">
            <div className="w-12 h-12 bg-gradient-to-tr from-pink-600 via-orange-500 to-yellow-400 rounded-2xl flex items-center justify-center shadow-lg shadow-pink-500/20 rotate-3">
              <Palette className="w-7 h-7 text-white" />
            </div>
            <span className="text-2xl font-black tracking-tighter bg-clip-text text-transparent bg-gradient-to-r from-white to-gray-400">
              HOLI<span className="text-pink-500">AI</span>
            </span>
          </div>
          <div className="hidden md:flex items-center gap-8 text-sm font-medium text-gray-400">
            <a href="#" className="hover:text-white transition-colors">होम</a>
            <a href="#features" className="hover:text-white transition-colors">फीचर्स</a>
            <a href="#how-it-works" className="hover:text-white transition-colors">कैसे काम करता है</a>
          </div>
          <button 
            onClick={scrollToEditor}
            className="group relative bg-white text-black px-8 py-2.5 rounded-full font-bold text-sm overflow-hidden"
          >
            <span className="relative z-10">मैजिक शुरू करें</span>
            <div className="absolute inset-0 bg-gradient-to-r from-yellow-400 to-pink-500 translate-y-full group-hover:translate-y-0 transition-transform duration-300" />
          </button>
        </div>
      </nav>

      {/* Hero Section */}
      <section className="relative pt-40 pb-32 px-6 flex flex-col items-center text-center overflow-hidden">
        {/* Decorative SVG splashes */}
        <div className="absolute top-20 -left-20 w-96 h-96 bg-pink-600/20 rounded-full blur-[120px]" />
        <div className="absolute bottom-0 -right-20 w-96 h-96 bg-yellow-500/10 rounded-full blur-[120px]" />

        <div className="inline-flex items-center gap-2 bg-gradient-to-r from-pink-500/10 to-orange-500/10 border border-pink-500/20 px-5 py-2 rounded-full mb-10 animate-bounce">
          <Sparkles className="w-4 h-4 text-pink-400" />
          <span className="text-xs font-bold tracking-widest uppercase text-pink-200">World's #1 Holi Photo AI</span>
        </div>
        
        <h1 className="text-6xl md:text-[10rem] font-black mb-8 leading-[0.85] tracking-tighter italic">
          RANGON KA <br />
          <span className="text-transparent bg-clip-text bg-gradient-to-b from-yellow-300 via-pink-500 to-purple-700 drop-shadow-2xl">
            FESTIVAL
          </span>
        </h1>

        <p className="text-gray-400 text-lg md:text-2xl max-w-2xl mb-12 font-medium leading-relaxed">
          अपनी साधारण फोटो को एक जादुई होली सेलिब्रेशन में बदलें। हमारा शक्तिशाली AI सिर्फ 10 सेकंड में आपके चेहरे और कपड़ों पर असली गुलाल के रंग बिखेर देगा।
        </p>

        <div className="flex flex-col md:flex-row gap-5 items-center">
          <button 
            onClick={scrollToEditor}
            className="group relative bg-pink-600 px-12 py-6 rounded-[2rem] font-black text-2xl flex items-center gap-4 hover:scale-105 active:scale-95 transition-all shadow-2xl shadow-pink-600/40"
          >
            फोटो अपलोड करें <Camera className="w-8 h-8 group-hover:rotate-12 transition-transform" />
          </button>
          <div className="flex -space-x-3">
            {[1,2,3,4].map(i => (
              <div key={i} className="w-12 h-12 rounded-full border-4 border-neutral-950 bg-neutral-800 flex items-center justify-center text-[10px] font-bold">
                User{i}
              </div>
            ))}
            <div className="w-12 h-12 rounded-full border-4 border-neutral-950 bg-pink-600 flex items-center justify-center text-xs font-bold">+2k</div>
          </div>
        </div>
      </section>

      {/* Editor Section */}
      <section ref={editorRef} className="py-24 px-6 relative z-10 scroll-mt-24">
        <div className="max-w-5xl mx-auto">
          <div className="relative p-1 bg-gradient-to-tr from-pink-500/20 via-yellow-500/20 to-purple-500/20 rounded-[4rem]">
            <div className="bg-neutral-900/90 backdrop-blur-3xl rounded-[3.8rem] p-6 md:p-12 border border-white/5">
              
              <div className="grid md:grid-cols-12 gap-10 items-center">
                
                {/* Visualizer */}
                <div className="md:col-span-7">
                  <div className="aspect-[4/5] md:aspect-square w-full bg-black/50 rounded-[3rem] border-2 border-dashed border-white/10 flex flex-col items-center justify-center relative overflow-hidden group">
                    {!originalImage ? (
                      <div onClick={() => fileInputRef.current.click()} className="cursor-pointer group flex flex-col items-center p-12 text-center">
                        <div className="w-24 h-24 bg-gradient-to-br from-white/5 to-white/10 rounded-3xl flex items-center justify-center mb-8 group-hover:scale-110 transition-all duration-500 shadow-xl border border-white/10">
                          <ImageIcon className="w-10 h-10 text-pink-500" />
                        </div>
                        <h3 className="text-3xl font-black mb-3">यहाँ फोटो छोड़ें</h3>
                        <p className="text-gray-500 max-w-xs">AI अपने आप चेहरे को पहचान कर रंगों का छिड़काव करेगा</p>
                        <input type="file" ref={fileInputRef} onChange={handleUpload} className="hidden" accept="image/*" />
                      </div>
                    ) : (
                      <div className="w-full h-full relative">
                        <img 
                          src={processedImage || originalImage} 
                          className={`w-full h-full object-cover transition-all duration-1000 ${isProcessing ? 'blur-2xl opacity-40' : 'blur-0'}`} 
                          alt="Holi Magic Result" 
                        />
                        {isProcessing && (
                          <div className="absolute inset-0 flex flex-col items-center justify-center">
                            <RefreshCw className="w-20 h-20 text-pink-500 animate-spin mb-8" />
                            <div className="flex gap-1">
                              {[...Array(3)].map((_, i) => (
                                <div key={i} className="w-2 h-2 bg-pink-500 rounded-full animate-bounce" style={{ animationDelay: `${i * 0.2}s` }} />
                              ))}
                            </div>
                          </div>
                        )}
                      </div>
                    )}
                  </div>
                </div>

                {/* Controls & Status */}
                <div className="md:col-span-5 space-y-8">
                  <div>
                    <h2 className="text-4xl font-black mb-4">होली मैजिक <span className="text-pink-500">LAB</span></h2>
                    <p className="text-gray-400">हमारा AI इंजिन रंगों की गहराई और स्किन टोन को मैच करता है ताकि फोटो एकदम नेचुरल लगे।</p>
                  </div>

                  <div className="space-y-4">
                    {[
                      { icon: <Zap className="w-4 h-4 text-yellow-400" />, text: "स्मार्ट कलर डिटेक्शन" },
                      { icon: <Layers className="w-4 h-4 text-blue-400" />, text: "मल्टी-लेयर बेंडिंग" },
                      { icon: <Smile className="w-4 h-4 text-green-400" />, text: "फेशियल फीचर प्रिजर्वेशन" }
                    ].map((item, i) => (
                      <div key={i} className="flex items-center gap-3 bg-white/5 p-4 rounded-2xl border border-white/5">
                        <div className="w-8 h-8 rounded-lg bg-black/40 flex items-center justify-center">{item.icon}</div>
                        <span className="text-sm font-bold text-gray-200">{item.text}</span>
                      </div>
                    ))}
                  </div>

                  {!isProcessing && originalImage && (
                    <div className="flex gap-4">
                      <button onClick={() => setOriginalImage(null)} className="flex-1 bg-neutral-800 py-5 rounded-2xl font-bold hover:bg-neutral-700 transition-all border border-white/5">
                        हटाएं
                      </button>
                      <button 
                        onClick={() => {
                          const link = document.createElement('a');
                          link.download = 'holi_magic_ai.png';
                          link.href = processedImage || originalImage;
                          link.click();
                        }} 
                        className="flex-[2] bg-white text-black py-5 rounded-2xl font-black flex items-center justify-center gap-2 hover:scale-105 transition-all shadow-xl shadow-white/10"
                      >
                        <Download className="w-5 h-5" /> सेव करें
                      </button>
                    </div>
                  )}
                </div>
              </div>
            </div>
          </div>
        </div>
      </section>

      {/* How it Works Section */}
      <section id="how-it-works" className="py-32 px-6 relative">
        <div className="max-w-7xl mx-auto text-center mb-20">
          <h2 className="text-5xl font-black mb-6 italic">यह कैसे <span className="text-pink-600 underline">काम करता है?</span></h2>
          <p className="text-gray-400">सिर्फ 3 आसान स्टेप्स में अपनी फोटो को फेस्टिव बनाएं</p>
        </div>

        <div className="max-w-7xl mx-auto grid md:grid-cols-3 gap-12 relative">
          {/* Connector Line */}
          <div className="hidden md:block absolute top-1/2 left-0 w-full h-1 bg-gradient-to-r from-pink-500/0 via-pink-500/20 to-pink-500/0 -translate-y-1/2 z-0" />
          
          {[
            { step: "01", title: "फोटो चुनें", desc: "गैलरी से अपनी पसंदीदा सिंगल या ग्रुप फोटो अपलोड करें।", icon: <ImageIcon className="w-8 h-8" /> },
            { step: "02", title: "AI प्रोसेसिंग", desc: "हमारा मैजिक एल्गोरिदम रंगों का छिड़काव शुरू करता है।", icon: <Sparkles className="w-8 h-8" /> },
            { step: "03", title: "मैजिक डाउनलोड", desc: "अपनी रंगीन फोटो को HD क्वालिटी में डाउनलोड करें और शेयर करें।", icon: <Download className="w-8 h-8" /> }
          ].map((item, i) => (
            <div key={i} className="relative z-10 bg-neutral-900/50 p-10 rounded-[3rem] border border-white/5 hover:bg-neutral-900 transition-all group">
              <div className="text-7xl font-black text-white/5 absolute top-6 right-10 group-hover:text-pink-500/10 transition-colors">{item.step}</div>
              <div className="w-16 h-16 bg-pink-600 rounded-2xl flex items-center justify-center mb-8 shadow-lg shadow-pink-600/20 group-hover:rotate-6 transition-transform">
                {item.icon}
              </div>
              <h4 className="text-2xl font-black mb-4">{item.title}</h4>
              <p className="text-gray-400 leading-relaxed">{item.desc}</p>
            </div>
          ))}
        </div>
      </section>

      {/* Features Showcase Section */}
      <section id="features" className="py-32 px-6 bg-gradient-to-b from-transparent to-pink-600/5">
        <div className="max-w-7xl mx-auto">
          <div className="grid md:grid-cols-2 gap-20 items-center">
            <div>
              <div className="w-16 h-1 bg-pink-600 mb-8" />
              <h2 className="text-5xl font-black mb-8 leading-tight">सिर्फ रंग नहीं, <br />एक <span className="text-yellow-500">अनुभव</span> है।</h2>
              <div className="space-y-6">
                {[
                  { title: "HD आउटपुट", desc: "आपकी फोटो की क्वालिटी कम नहीं होती।" },
                  { title: "ग्रुप फोटो सपोर्ट", desc: "एक साथ 5 लोगों तक की फोटो को एडिट करें।" },
                  { title: "रियल-टाइम प्रीव्यू", desc: "होने वाले बदलावों को तुरंत देखें।" }
                ].map((f, i) => (
                  <div key={i} className="flex gap-4">
                    <CheckCircle2 className="w-6 h-6 text-green-500 flex-shrink-0" />
                    <div>
                      <h5 className="font-bold text-xl">{f.title}</h5>
                      <p className="text-gray-400 text-sm">{f.desc}</p>
                    </div>
                  </div>
                ))}
              </div>
            </div>
            
            <div className="relative">
              <div className="aspect-square bg-neutral-800 rounded-[4rem] overflow-hidden rotate-3 shadow-2xl relative z-10">
                 {/* Placeholder for "Before/After" visual */}
                 <div className="absolute inset-0 bg-gradient-to-tr from-pink-600/40 to-yellow-500/40 mix-blend-overlay" />
                 <img src="https://images.unsplash.com/photo-1540910419892-f0c74b0e8966?q=80&w=800&auto=format&fit=crop" className="w-full h-full object-cover" alt="Holi Festival Example" />
                 <div className="absolute bottom-10 left-10 bg-black/60 backdrop-blur-md px-6 py-3 rounded-2xl border border-white/10">
                   <p className="font-bold text-white flex items-center gap-2 italic"><Star className="w-4 h-4 text-yellow-400 fill-yellow-400" /> AI द्वारा जनरेटेड</p>
                 </div>
              </div>
              <div className="absolute inset-0 bg-pink-600 rounded-[4rem] -rotate-3 z-0 translate-x-4 translate-y-4 blur-sm opacity-20" />
            </div>
          </div>
        </div>
      </section>

      {/* FAQs Section */}
      <section className="py-32 px-6">
        <div className="max-w-3xl mx-auto">
          <h2 className="text-4xl font-black mb-16 text-center">अक्सर पूछे जाने वाले <span className="text-pink-500">सवाल</span></h2>
          <div className="space-y-4">
            {[
              { q: "क्या यह पूरी तरह फ्री है?", a: "हाँ, आप जितनी चाहें उतनी फोटो बिल्कुल मुफ्त में एडिट कर सकते हैं।" },
              { q: "क्या मेरी फोटो सुरक्षित हैं?", a: "बिल्कुल। हम आपकी फोटो सर्वर पर सेव नहीं करते। प्रोसेसिंग के बाद वे डिलीट हो जाती हैं।" },
              { q: "क्या यह मोबाइल पर काम करेगा?", a: "हाँ, यह वेबसाइट मोबाइल ब्राउज़र के लिए पूरी तरह ऑप्टिमाइज्ड है।" }
            ].map((faq, i) => (
              <details key={i} className="group bg-neutral-900 border border-white/5 rounded-3xl overflow-hidden cursor-pointer">
                <summary className="p-8 font-bold text-xl flex justify-between items-center list-none">
                  {faq.q}
                  <ChevronDown className="w-5 h-5 group-open:rotate-180 transition-transform" />
                </summary>
                <div className="px-8 pb-8 text-gray-400 leading-relaxed">
                  {faq.a}
                </div>
              </details>
            ))}
          </div>
        </div>
      </section>

      {/* Final CTA */}
      <section className="py-32 px-6">
        <div className="max-w-7xl mx-auto bg-gradient-to-r from-pink-600 to-orange-600 rounded-[4rem] p-16 text-center shadow-3xl shadow-pink-600/30 overflow-hidden relative">
          <div className="relative z-10">
            <h2 className="text-5xl md:text-7xl font-black mb-8 leading-tight">इंतज़ार मत करो, <br />रंगों में घुल जाओ!</h2>
            <button 
              onClick={scrollToEditor}
              className="bg-white text-black px-12 py-6 rounded-3xl font-black text-2xl hover:scale-105 transition-all shadow-2xl flex items-center gap-4 mx-auto"
            >
              मैजिक शुरू करें <ArrowRight className="w-8 h-8" />
            </button>
          </div>
          <Sparkles className="absolute top-10 left-10 w-24 h-24 text-white/10 rotate-12" />
          <Palette className="absolute bottom-0 right-10 w-40 h-40 text-white/10 -rotate-12" />
        </div>
      </section>

      {/* Footer */}
      <footer className="py-20 px-6 border-t border-white/5 text-center">
        <div className="flex justify-center gap-4 mb-8">
          {[...Array(5)].map((_, i) => <Heart key={i} className={`w-5 h-5 ${i % 2 === 0 ? 'text-pink-500' : 'text-orange-500'} animate-pulse`} />)}
        </div>
        <div className="flex items-center justify-center gap-3 mb-10">
           <div className="w-8 h-8 bg-white/5 rounded-lg flex items-center justify-center font-black">H</div>
           <span className="text-lg font-bold">HOLI.AI</span>
        </div>
        <p className="text-gray-500 text-sm max-w-xs mx-auto mb-10">भारत का सबसे पसंदीदा AI फोटो एडिटर। बुरा न मानो होली है!</p>
        <div className="flex justify-center gap-8 text-xs font-bold text-gray-600 uppercase tracking-widest">
          <a href="#" className="hover:text-white transition-colors">Privacy</a>
          <a href="#" className="hover:text-white transition-colors">Terms</a>
          <a href="#" className="hover:text-white transition-colors">Contact</a>
        </div>
      </footer>
    </div>
  );
};

export default App;

